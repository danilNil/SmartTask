var tasks_source = require('../../data_sources/tasks_source.js')

module.exports.fetchTasks = function (req, res, next) {
	tasks_source.fetchTasks(req, res, next);
};

module.exports.saveLists = function(req, res, next) {
		console.log("saveLists started");
		var pg = require('pg');
		var conString = "postgres://postgres:123@localhost/smart_tasks";
		var client = new pg.Client(conString);
		var tasks = req.tasks;
		console.log("!!! req.tasks");
	    console.log(req.tasks);
	    client.connect();
	  	client.query("CREATE TABLE IF NOT EXISTS tasks (id text PRIMARY KEY, title text)");
	  	for (var i = tasks.length - 1; i >= 0; i--) {
			client.query("INSERT INTO tasks (id, title) VALUES($1, $2)", [tasks[i].id, tasks[i].title]);
		};
		client.end();
		next();
}

module.exports.get = function (req, res, next) {
	res.render('tasks', {tasks : req.tasks});	
};
