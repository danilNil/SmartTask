var tasks_source = require('../../data_sources/tasks_source.js')


// function tasks() {
  
// };

module.exports.middleware = function (app) {
	return function (req, res, next) {
		next();
	}
};

module.exports.get = function (req, res, next) {
	fetchTasks(function (tasks, err) {
		if(err) 
			next(err);
		else{
			saveLists(tasks);
			res.render('tasks', {tasks : tasks});	
		}
	});
};

function saveLists (tasks) {
	var pg = require('pg');
	var conString = "postgres://postgres:123@localhost/smart_tasks";
	var client = new pg.Client(conString);
	
	client.connect();
  	client.query("CREATE TABLE IF NOT EXISTS tasks (id text PRIMARY KEY, title text)");
  	for (var i = tasks.length - 1; i >= 0; i--) {
		client.query("INSERT INTO tasks (id, title) VALUES($1, $2)", [tasks[i].id, tasks[i].title]);
	};
	client.end();
}


function fetchTasks(callback){
	tasks_source.fetchTasks(callback);
}

//module.exports = tasks;
